<div class="services">         
  <div class="service-sidebar">
    <%= render partial: "backstage_sidebar" %>
  </div>        
  <div class="service-display">
    <h3>預約月曆</h3>
    <br>
    <div role="tabpanel">
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li class="active">
          <a href="#booked" data-toggle="tab"><h4>待診人數</h4></a>
        </li>
        <li>
          <a href="#bookable" data-toggle="tab"><h4>保留名額</h4></a>
        </li>          
      </ul>

      <!-- Tab panes -->
      <div class="tab-content">
        <div class="tab-pane active" id="booked">
          <% @calendar_user = nil %>
          <%= month_calendar do |date| %>
            <%= date.strftime("%d") %> <br>
            <% booking_slots = @booking_slots.select{|b| b.booking_date == date} %>

            <% if booking_slots.count > 0 %>
              <% morning_booked_count = booking_slots.select{|b| b.time_slot < 24 and b.is_booked == true}.count %>
              <% afternoon_booked_count = booking_slots.select{|b| b.time_slot >= 24 and b.time_slot < 36 and b.is_booked == true}.count %>
              <% evenning_booked_count = booking_slots.select{|b| b.time_slot >= 36 and b.is_booked == true}.count %>                            
      
              <%= link_to backstage_reservation_week_path(date: date, anchor: "morning") do %>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp上午 <%= morning_booked_count %><br>
              <% end %>       

              <%= link_to backstage_reservation_week_path(date: date, anchor: "afternoon") do %>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp下午 <%= afternoon_booked_count %><br>
              <% end %>       

              <%= link_to backstage_reservation_week_path(date: date, anchor: "evening") do %>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp晚上 <%= evenning_booked_count %><br>
              <% end %>               
              <br>
           
            <% else %>
              &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp無名額<br>&nbsp<br>&nbsp
            <% end %>
          <% end %>          
        </div>

        <div class="tab-pane" id="bookable">
          <%= month_calendar do |date| %>
            <%= date.strftime("%d") %> <br>
            <% booking_slots = @booking_slots.select{|b| b.booking_date == date} %>

            <% if booking_slots.count > 0 %>                 
              <% morning_not_bookable_and_not_booked_count = booking_slots.select{|b| b.time_slot < 24 and b.bookable == false and b.is_booked == false}.count %>
              <% afternoon_not_bookable_and_not_booked_count = booking_slots.select{|b| b.time_slot >= 24 and b.time_slot < 36 and b.bookable == false and b.is_booked == false}.count %>
              <% evenning_not_bookable_and_not_booked_count = booking_slots.select{|b| b.time_slot >= 36 and b.bookable == false and b.is_booked == false}.count %>   

              <%= link_to backstage_reservation_week_path(date: date, anchor: "morning") do %>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp上午 <%= morning_not_bookable_and_not_booked_count %><br>
              <% end %>       

              <%= link_to backstage_reservation_week_path(date: date, anchor: "afternoon") do %>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp下午 <%= afternoon_not_bookable_and_not_booked_count %><br>
              <% end %>       

              <%= link_to backstage_reservation_week_path(date: date, anchor: "evening") do %>
                &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp晚上 <%= evenning_not_bookable_and_not_booked_count %><br>
              <% end %>               
              <br>
           
            <% else %>
              &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp無名額<br>&nbsp<br>&nbsp
            <% end %>
          <% end %>            
        </div>

      </div>
    </div>


  </div>
  <div class="clear"> </div>
</div>
<div class="clear"> </div>
